{% extends "base.html" %}

{% block nav_center %}
    <h1 class="nav-title">Your Feed</h1>
{% endblock %}

{% block content %}
<div class="dashboard-content">
    {% for post in posts %}
        <div class="post-card">
            <div class="post-author">
                <img src="{{ url_for('get_avatar', user_id=post.user.id) }}" alt="Avatar" class="post-avatar">
                <a href="{{ url_for('user_profile', username=post.user.username) }}" class="post-author-link">
                    {{ post.user.username }}
                </a>
            </div>
            <img src="{{ url_for('get_photo', post_id=post.id) }}" alt="Post image" class="post-image">
            <div class="post-details">
                <p class="post-caption">{{ post.caption }}</p>
                <div class="post-stats">
                    <form method="POST" action="{{ url_for('like_post', post_id=post.id) }}" class="like-form" data-post-id="{{ post.id }}">
                        {% set user_liked = post.likes|selectattr('user_id', 'equalto', session['user_id']|int)|list %}
                        <button type="submit" class="like-icon {% if user_liked %}liked{% endif %}">
                            <i class="fa {% if user_liked %}fa-heart{% else %}fa-heart-o{% endif %}"></i>
                        </button>
                    </form>
                    <span class="likes-count">{{ post.likes|length }}</span>
                    <span>Comments: {{ post.comments|length }}</span>
                </div>
                {% if post.user_id == session['user_id'] or session.get('role') == 'admin' %}
                    <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" style="margin-top: 10px;" onsubmit="return confirmDelete();">
                        <button type="submit" class="delete-button">Delete</button>
                    </form>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}